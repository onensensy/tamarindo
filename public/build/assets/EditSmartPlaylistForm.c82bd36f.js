import{v as O,aj as R,au as K,a1 as L,b as y,y as U,a9 as q,z as l,C as v,O as n,B as t,G as e,R as i,aa as h,aH as Y,bI as j,A as m,Y as g,N as z,Z as w,P as u,bB as H,F as p,aG as Z,at as $,k as J,l as Q}from"./index.8f0bf197.js";import{k as W,l as X}from"./app.be92839b.js";import{u as ee}from"./useModal.8598f864.js";import{u as oe}from"./useOverlay.b8f8c136.js";import{u as se}from"./useSmartPlaylistForm.7df2de33.js";import"./Btn.abe2bb59.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./SoundBars.e7c8d9da.js";const te=["onSubmit","onKeydown"],ae=e("header",null,[e("h1",null,"Edit Smart Playlist")],-1),le={class:"form-row cols"},re={class:"name"},ne={class:"folder"},ie=e("option",{value:null},null,-1),ue=["value"],ce={class:"form-row rules"},we=O({__name:"EditSmartPlaylistForm",emits:["close"],setup(de,{emit:b}){const{showOverlay:k,hideOverlay:C}=oe(),{toastSuccess:S}=W(),{showConfirmDialog:P,showErrorDialog:x}=X(),a=ee().getFromContext("playlist"),B=R(K.state,"folders"),o=L(y.exports.cloneDeep(a)),D=()=>y.exports.isEqual(o.rules,a.rules)&&o.name.trim()===a.name&&o.folder_id===a.folder_id,{Btn:c,FormBase:F,RuleGroup:E,collectedRuleGroups:G,addGroup:I,onGroupChanged:M}=se(o.rules),d=()=>b("close"),_=async()=>{if(D()){d();return}await P("Discard all changes?")&&d()},N=async()=>{k(),o.rules=G.value;try{await $.update(a,o),S(`Playlist "${a.name}" updated.`),J.emit("PLAYLIST_UPDATED",a),d()}catch(f){x("Something went wrong. Please try again.","Error"),Q.error(f)}finally{C()}};return(f,r)=>{const T=U("Icon"),V=q("koel-focus");return l(),v(t(F),null,{default:n(()=>[e("form",{onSubmit:p(N,["prevent"]),onKeydown:Z(_,["esc"])},[ae,e("main",null,[e("div",le,[e("label",re,[i(" Name "),h(e("input",{"onUpdate:modelValue":r[0]||(r[0]=s=>o.name=s),name:"name",placeholder:"Playlist name",required:"",type:"text"},null,512),[[Y,o.name],[V]])]),e("label",ne,[i(" Folder "),h(e("select",{"onUpdate:modelValue":r[1]||(r[1]=s=>o.folder_id=s)},[ie,(l(!0),m(w,null,g(B.value,s=>(l(),m("option",{key:s.id,value:s.id},z(s.name),9,ue))),128))],512),[[j,o.folder_id]])])]),e("div",ce,[(l(!0),m(w,null,g(o.rules,(s,A)=>(l(),v(t(E),{key:s.id,group:s,"is-first-group":A===0,onInput:t(M)},null,8,["group","is-first-group","onInput"]))),128)),u(t(c),{class:"btn-add-group",green:"",small:"",title:"Add a new group",uppercase:"",onClick:p(t(I),["prevent"])},{default:n(()=>[u(T,{icon:t(H)},null,8,["icon"])]),_:1},8,["onClick"])])]),e("footer",null,[u(t(c),{type:"submit"},{default:n(()=>[i("Save")]),_:1}),u(t(c),{class:"btn-cancel",white:"",onClick:p(_,["prevent"])},{default:n(()=>[i("Cancel")]),_:1},8,["onClick"])])],40,te)]),_:1})}}});export{we as default};
