var Ct=Object.defineProperty;var Rt=(t,e,n)=>e in t?Ct(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var V=(t,e,n)=>(Rt(t,typeof e!="symbol"?e+"":e,n),n);import{p as Lt,w as me,r as ot,s as j,q as x,e as T,l as ze,a as te,h as Ue,i as At,c as xe,b as Me,u as fe,d as Pt,f as Ie,g as De,j as k,k as de,m as ue,n as U,o as Ot,t as $t,v as $,x as st,y as G,z as m,A as E,B as p,C,D as It,E as Mt,F as z,G as R,H as Nt,I as L,J as Dt,K as at,L as Ft,M as Vt,N as he,O as ge,P as g,Q as ae,R as Ge,S as it,T as rt,U as ct,V as Re,W as Bt,X as Ht,Y as zt,Z as lt,_ as Ut,$ as M,a0 as N,a1 as Gt,a2 as Kt,a3 as qt,a4 as Wt,a5 as jt,a6 as Yt,a7 as ut,a8 as Qt,a9 as Fe,aa as ne,ab as Se,ac as Xt,ad as Zt,ae as Jt,af as en,ag as tn,ah as nn,ai as on,aj as sn,ak as dt,al as an,am as rn,an as cn,ao as ln,ap as un,aq as dn,ar as pn,as as pt,at as fn,au as _n,av as ft,aw as mn,ax as be,ay as hn,az as gn,aA as vn}from"./index.8f0bf197.js";import{B as Ke,f as yn}from"./Btn.abe2bb59.js";import{_ as H}from"./_plugin-vue_export-helper.cdc0426e.js";const wn={mounted:t=>t.focus()};function Le(t){return t.split("-")[0]}function Ae(t){return t.split("-")[1]}function Pe(t){return["top","bottom"].includes(Le(t))?"x":"y"}function Ve(t){return t==="y"?"height":"width"}function qe(t,e,n){let{reference:o,floating:s}=t;const a=o.x+o.width/2-s.width/2,c=o.y+o.height/2-s.height/2,i=Pe(e),d=Ve(i),u=o[d]/2-s[d]/2,l=Le(e),r=i==="x";let f;switch(l){case"top":f={x:a,y:o.y-s.height};break;case"bottom":f={x:a,y:o.y+o.height};break;case"right":f={x:o.x+o.width,y:c};break;case"left":f={x:o.x-s.width,y:c};break;default:f={x:o.x,y:o.y}}switch(Ae(e)){case"start":f[i]-=u*(n&&r?-1:1);break;case"end":f[i]+=u*(n&&r?-1:1);break}return f}const bn=async(t,e,n)=>{const{placement:o="bottom",strategy:s="absolute",middleware:a=[],platform:c}=n,i=await(c.isRTL==null?void 0:c.isRTL(e));let d=await c.getElementRects({reference:t,floating:e,strategy:s}),{x:u,y:l}=qe(d,o,i),r=o,f={},h=0;for(let _=0;_<a.length;_++){const{name:v,fn:y}=a[_],{x:w,y:b,data:A,reset:S}=await y({x:u,y:l,initialPlacement:o,placement:r,strategy:s,middlewareData:f,rects:d,platform:c,elements:{reference:t,floating:e}});if(u=w!=null?w:u,l=b!=null?b:l,f={...f,[v]:{...f[v],...A}},S&&h<=50){h++,typeof S=="object"&&(S.placement&&(r=S.placement),S.rects&&(d=S.rects===!0?await c.getElementRects({reference:t,floating:e,strategy:s}):S.rects),{x:u,y:l}=qe(d,r,i)),_=-1;continue}}return{x:u,y:l,placement:r,strategy:s,middlewareData:f}};function xn(t){return{top:0,right:0,bottom:0,left:0,...t}}function _t(t){return typeof t!="number"?xn(t):{top:t,right:t,bottom:t,left:t}}function Ee(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}async function Sn(t,e){var n;e===void 0&&(e={});const{x:o,y:s,platform:a,rects:c,elements:i,strategy:d}=t,{boundary:u="clippingAncestors",rootBoundary:l="viewport",elementContext:r="floating",altBoundary:f=!1,padding:h=0}=e,_=_t(h),y=i[f?r==="floating"?"reference":"floating":r],w=Ee(await a.getClippingRect({element:(n=await(a.isElement==null?void 0:a.isElement(y)))==null||n?y:y.contextElement||await(a.getDocumentElement==null?void 0:a.getDocumentElement(i.floating)),boundary:u,rootBoundary:l,strategy:d})),b=Ee(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({rect:r==="floating"?{...c.floating,x:o,y:s}:c.reference,offsetParent:await(a.getOffsetParent==null?void 0:a.getOffsetParent(i.floating)),strategy:d}):c[r]);return{top:w.top-b.top+_.top,bottom:b.bottom-w.bottom+_.bottom,left:w.left-b.left+_.left,right:b.right-w.right+_.right}}const En=Math.min,kn=Math.max;function Tn(t,e,n){return kn(t,En(e,n))}const Cn=t=>({name:"arrow",options:t,async fn(e){const{element:n,padding:o=0}=t!=null?t:{},{x:s,y:a,placement:c,rects:i,platform:d}=e;if(n==null)return{};const u=_t(o),l={x:s,y:a},r=Pe(c),f=Ae(c),h=Ve(r),_=await d.getDimensions(n),v=r==="y"?"top":"left",y=r==="y"?"bottom":"right",w=i.reference[h]+i.reference[r]-l[r]-i.floating[h],b=l[r]-i.reference[r],A=await(d.getOffsetParent==null?void 0:d.getOffsetParent(n));let S=A?r==="y"?A.clientHeight||0:A.clientWidth||0:0;S===0&&(S=i.floating[h]);const O=w/2-b/2,Z=u[v],re=S-_[h]-u[y],D=S/2-_[h]/2+O,F=Tn(Z,D,re),P=(f==="start"?u[v]:u[y])>0&&D!==F&&i.reference[h]<=i.floating[h]?D<Z?Z-D:re-D:0;return{[r]:l[r]-P,data:{[r]:F,centerOffset:D-F}}}}),Rn={left:"right",right:"left",bottom:"top",top:"bottom"};function ke(t){return t.replace(/left|right|bottom|top/g,e=>Rn[e])}function Ln(t,e,n){n===void 0&&(n=!1);const o=Ae(t),s=Pe(t),a=Ve(s);let c=s==="x"?o===(n?"end":"start")?"right":"left":o==="start"?"bottom":"top";return e.reference[a]>e.floating[a]&&(c=ke(c)),{main:c,cross:ke(c)}}const An={start:"end",end:"start"};function We(t){return t.replace(/start|end/g,e=>An[e])}function Pn(t){const e=ke(t);return[We(t),e,We(e)]}const ks=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n;const{placement:o,middlewareData:s,rects:a,initialPlacement:c,platform:i,elements:d}=e,{mainAxis:u=!0,crossAxis:l=!0,fallbackPlacements:r,fallbackStrategy:f="bestFit",flipAlignment:h=!0,..._}=t,v=Le(o),w=r||(v===c||!h?[ke(c)]:Pn(c)),b=[c,...w],A=await Sn(e,_),S=[];let O=((n=s.flip)==null?void 0:n.overflows)||[];if(u&&S.push(A[v]),l){const{main:F,cross:ce}=Ln(o,a,await(i.isRTL==null?void 0:i.isRTL(d.floating)));S.push(A[F],A[ce])}if(O=[...O,{placement:o,overflows:S}],!S.every(F=>F<=0)){var Z,re;const F=((Z=(re=s.flip)==null?void 0:re.index)!=null?Z:0)+1,ce=b[F];if(ce)return{data:{index:F,overflows:O},reset:{placement:ce}};let le="bottom";switch(f){case"bestFit":{var D;const P=(D=O.map(J=>[J,J.overflows.filter(pe=>pe>0).reduce((pe,Tt)=>pe+Tt,0)]).sort((J,pe)=>J[1]-pe[1])[0])==null?void 0:D[0].placement;P&&(le=P);break}case"initialPlacement":le=c;break}if(o!==le)return{reset:{placement:le}}}return{}}}};async function On(t,e){const{placement:n,platform:o,elements:s}=t,a=await(o.isRTL==null?void 0:o.isRTL(s.floating)),c=Le(n),i=Ae(n),d=Pe(n)==="x",u=["left","top"].includes(c)?-1:1,l=a&&d?-1:1,r=typeof e=="function"?e(t):e;let{mainAxis:f,crossAxis:h,alignmentAxis:_}=typeof r=="number"?{mainAxis:r,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...r};return i&&typeof _=="number"&&(h=i==="end"?_*-1:_),d?{x:h*l,y:f*u}:{x:f*u,y:h*l}}const $n=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){const{x:n,y:o}=e,s=await On(e,t);return{x:n+s.x,y:o+s.y,data:s}}}};function mt(t){return t&&t.document&&t.location&&t.alert&&t.setInterval}function X(t){if(t==null)return window;if(!mt(t)){const e=t.ownerDocument;return e&&e.defaultView||window}return t}function oe(t){return X(t).getComputedStyle(t)}function se(t){return mt(t)?"":t?(t.nodeName||"").toLowerCase():""}function ht(){const t=navigator.userAgentData;return t!=null&&t.brands?t.brands.map(e=>e.brand+"/"+e.version).join(" "):navigator.userAgent}function K(t){return t instanceof X(t).HTMLElement}function Y(t){return t instanceof X(t).Element}function In(t){return t instanceof X(t).Node}function ve(t){if(typeof ShadowRoot>"u")return!1;const e=X(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function ye(t){const{overflow:e,overflowX:n,overflowY:o,display:s}=oe(t);return/auto|scroll|overlay|hidden/.test(e+o+n)&&!["inline","contents"].includes(s)}function Mn(t){return["table","td","th"].includes(se(t))}function gt(t){const e=/firefox/i.test(ht()),n=oe(t);return n.transform!=="none"||n.perspective!=="none"||e&&n.willChange==="filter"||e&&(n.filter?n.filter!=="none":!1)||["transform","perspective"].some(o=>n.willChange.includes(o))||["paint","layout","strict","content"].some(o=>{const s=n.contain;return s!=null?s.includes(o):!1})}function vt(){return!/^((?!chrome|android).)*safari/i.test(ht())}function Be(t){return["html","body","#document"].includes(se(t))}const je=Math.min,_e=Math.max,Te=Math.round;function Q(t,e,n){var o,s,a,c;e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect();let d=1,u=1;e&&K(t)&&(d=t.offsetWidth>0&&Te(i.width)/t.offsetWidth||1,u=t.offsetHeight>0&&Te(i.height)/t.offsetHeight||1);const l=Y(t)?X(t):window,r=!vt()&&n,f=(i.left+(r&&(o=(s=l.visualViewport)==null?void 0:s.offsetLeft)!=null?o:0))/d,h=(i.top+(r&&(a=(c=l.visualViewport)==null?void 0:c.offsetTop)!=null?a:0))/u,_=i.width/d,v=i.height/u;return{width:_,height:v,top:h,right:f+_,bottom:h+v,left:f,x:f,y:h}}function ie(t){return((In(t)?t.ownerDocument:t.document)||window.document).documentElement}function Oe(t){return Y(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function yt(t){return Q(ie(t)).left+Oe(t).scrollLeft}function Nn(t){const e=Q(t);return Te(e.width)!==t.offsetWidth||Te(e.height)!==t.offsetHeight}function Dn(t,e,n){const o=K(e),s=ie(e),a=Q(t,o&&Nn(e),n==="fixed");let c={scrollLeft:0,scrollTop:0};const i={x:0,y:0};if(o||!o&&n!=="fixed")if((se(e)!=="body"||ye(s))&&(c=Oe(e)),K(e)){const d=Q(e,!0);i.x=d.x+e.clientLeft,i.y=d.y+e.clientTop}else s&&(i.x=yt(s));return{x:a.left+c.scrollLeft-i.x,y:a.top+c.scrollTop-i.y,width:a.width,height:a.height}}function He(t){return se(t)==="html"?t:t.assignedSlot||t.parentNode||(ve(t)?t.host:null)||ie(t)}function Ye(t){return!K(t)||oe(t).position==="fixed"?null:t.offsetParent}function Fn(t){let e=He(t);for(ve(e)&&(e=e.host);K(e)&&!Be(e);){if(gt(e))return e;{const n=e.parentNode;e=ve(n)?n.host:n}}return null}function Ne(t){const e=X(t);let n=Ye(t);for(;n&&Mn(n)&&oe(n).position==="static";)n=Ye(n);return n&&(se(n)==="html"||se(n)==="body"&&oe(n).position==="static"&&!gt(n))?e:n||Fn(t)||e}function Qe(t){if(K(t))return{width:t.offsetWidth,height:t.offsetHeight};const e=Q(t);return{width:e.width,height:e.height}}function Vn(t){let{rect:e,offsetParent:n,strategy:o}=t;const s=K(n),a=ie(n);if(n===a)return e;let c={scrollLeft:0,scrollTop:0};const i={x:0,y:0};if((s||!s&&o!=="fixed")&&((se(n)!=="body"||ye(a))&&(c=Oe(n)),K(n))){const d=Q(n,!0);i.x=d.x+n.clientLeft,i.y=d.y+n.clientTop}return{...e,x:e.x-c.scrollLeft+i.x,y:e.y-c.scrollTop+i.y}}function Bn(t,e){const n=X(t),o=ie(t),s=n.visualViewport;let a=o.clientWidth,c=o.clientHeight,i=0,d=0;if(s){a=s.width,c=s.height;const u=vt();(u||!u&&e==="fixed")&&(i=s.offsetLeft,d=s.offsetTop)}return{width:a,height:c,x:i,y:d}}function Hn(t){var e;const n=ie(t),o=Oe(t),s=(e=t.ownerDocument)==null?void 0:e.body,a=_e(n.scrollWidth,n.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),c=_e(n.scrollHeight,n.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0);let i=-o.scrollLeft+yt(t);const d=-o.scrollTop;return oe(s||n).direction==="rtl"&&(i+=_e(n.clientWidth,s?s.clientWidth:0)-a),{width:a,height:c,x:i,y:d}}function wt(t){const e=He(t);return Be(e)?t.ownerDocument.body:K(e)&&ye(e)?e:wt(e)}function Ce(t,e){var n;e===void 0&&(e=[]);const o=wt(t),s=o===((n=t.ownerDocument)==null?void 0:n.body),a=X(o),c=s?[a].concat(a.visualViewport||[],ye(o)?o:[]):o,i=e.concat(c);return s?i:i.concat(Ce(c))}function zn(t,e){const n=e.getRootNode==null?void 0:e.getRootNode();if(t.contains(e))return!0;if(n&&ve(n)){let o=e;do{if(o&&t===o)return!0;o=o.parentNode||o.host}while(o)}return!1}function Un(t,e){let n=t;for(;n&&!Be(n)&&!e.includes(n)&&!(Y(n)&&["absolute","fixed"].includes(oe(n).position));){const o=He(n);n=ve(o)?o.host:o}return n}function Gn(t,e){const n=Q(t,!1,e==="fixed"),o=n.top+t.clientTop,s=n.left+t.clientLeft;return{top:o,left:s,x:s,y:o,right:s+t.clientWidth,bottom:o+t.clientHeight,width:t.clientWidth,height:t.clientHeight}}function Xe(t,e,n){return e==="viewport"?Ee(Bn(t,n)):Y(e)?Gn(e,n):Ee(Hn(ie(t)))}function Kn(t){const e=Ce(t),n=Un(t,e);let o=null;if(n&&K(n)){const s=Ne(n);ye(n)?o=n:K(s)&&(o=s)}return Y(o)?e.filter(s=>o&&Y(s)&&zn(s,o)&&se(s)!=="body"):[]}function qn(t){let{element:e,boundary:n,rootBoundary:o,strategy:s}=t;const c=[...n==="clippingAncestors"?Kn(e):[].concat(n),o],i=c[0],d=c.reduce((u,l)=>{const r=Xe(e,l,s);return u.top=_e(r.top,u.top),u.right=je(r.right,u.right),u.bottom=je(r.bottom,u.bottom),u.left=_e(r.left,u.left),u},Xe(e,i,s));return{width:d.right-d.left,height:d.bottom-d.top,x:d.left,y:d.top}}const Wn={getClippingRect:qn,convertOffsetParentRelativeRectToViewportRelativeRect:Vn,isElement:Y,getDimensions:Qe,getOffsetParent:Ne,getDocumentElement:ie,getElementRects:t=>{let{reference:e,floating:n,strategy:o}=t;return{reference:Dn(e,Ne(n),o),floating:{...Qe(n),x:0,y:0}}},getClientRects:t=>Array.from(t.getClientRects()),isRTL:t=>oe(t).direction==="rtl"};function jn(t,e,n,o){o===void 0&&(o={});const{ancestorScroll:s=!0,ancestorResize:a=!0,elementResize:c=!0,animationFrame:i=!1}=o,d=s&&!i,u=d||a?[...Y(t)?Ce(t):[],...Ce(e)]:[];u.forEach(_=>{d&&_.addEventListener("scroll",n,{passive:!0}),a&&_.addEventListener("resize",n)});let l=null;if(c){let _=!0;l=new ResizeObserver(()=>{_||n(),_=!1}),Y(t)&&!i&&l.observe(t),l.observe(e)}let r,f=i?Q(t):null;i&&h();function h(){const _=Q(t);f&&(_.x!==f.x||_.y!==f.y||_.width!==f.width||_.height!==f.height)&&n(),f=_,r=requestAnimationFrame(h)}return n(),()=>{var _;u.forEach(v=>{d&&v.removeEventListener("scroll",n),a&&v.removeEventListener("resize",n)}),(_=l)==null||_.disconnect(),l=null,i&&cancelAnimationFrame(r)}}const Yn=(t,e,n)=>bn(t,e,{platform:Wn,...n}),Qn=!0,Ts=window.DataTransferItem&&typeof window.DataTransferItem.prototype.webkitGetAsEntry=="function",Xn=()=>Boolean(document.fullscreenEnabled),Zn=async(t,e,n,o)=>{n.placement=n.placement||"bottom";const{x:s,y:a,middlewareData:c}=await Yn(t,e,n);if(e.style.left=`${s}px`,e.style.top=`${a}px`,o){const{x:i,y:d}=c.arrow,u={top:"bottom",right:"left",bottom:"top",left:"right"}[n.placement.split("-")[0]];Object.assign(o.style,{left:i!=null?`${i}px`:"",top:d!=null?`${d}px`:"",right:"",bottom:"",[u]:"-4px"})}},Jn=t=>{if(t.$tooltip)return t.$tooltip;t.$tooltip=document.createElement("div"),t.$tooltip.classList.add("tooltip");const e=document.createElement("div");e.classList.add("tooltip-arrow");const n=document.createElement("div");return n.classList.add("tooltip-content"),t.$tooltip.appendChild(n),t.$tooltip.appendChild(e),document.body.appendChild(t.$tooltip),t.$tooltip},Ze=(t,e)=>{const n=Jn(t);n.querySelector(".tooltip-content").innerText=e.value||t.title||t.getAttribute("data-title")||t.innerText,t.title&&!t.getAttribute("data-title")&&(t.setAttribute("data-title",t.title),t.removeAttribute("title"));const o=n.querySelector(".tooltip-arrow");let s="bottom";["left","right","top","bottom"].forEach(d=>{e.modifiers[d]&&(s=d)});const a=async()=>await Zn(t,n,{placement:s,middleware:[Cn({element:o}),$n(8)]},o);t.$cleanup=t.$cleanup||jn(t,n,a);const c=async()=>{n.classList.add("show"),await a()},i=()=>n.classList.remove("show");t.addEventListener("mouseenter",c),t.addEventListener("focus",c),t.addEventListener("mouseleave",i),t.addEventListener("blur",i)},eo={mounted:Ze,updated:Ze,beforeUnmount:(t,e)=>{t.$cleanup&&t.$cleanup(),t.$tooltip&&document.body.removeChild(t.$tooltip)}},to={mounted:async t=>{t.addEventListener("error",()=>t.style.visibility="hidden"),t.src=t.src||""}},Je=t=>{t.classList.toggle("fade-top",t.scrollTop!==0),t.classList.toggle("fade-bottom",t.scrollTop+t.clientHeight!==t.scrollHeight)},no=(t,e)=>{new IntersectionObserver(o=>o.forEach(s=>s.isIntersecting&&e())).observe(t)},oo={mounted:async t=>{no(t,()=>Je(t)),t.addEventListener("scroll",()=>requestAnimationFrame(()=>Je(t)))}},bt=Symbol("Router"),so=Symbol("Overlay"),xt=Symbol("DialogBox"),St=Symbol("MessageToaster"),Cs=Symbol("Songs"),we=Symbol("CurrentSong"),Rs=Symbol("SelectedSongs"),Ls=Symbol("SongListConfig"),As=Symbol("SongListSortField"),Ps=Symbol("SongListSortOrder"),Os=Symbol("SongListFilterKeywords"),$s=Symbol("ModalContext"),ao=30;class io{constructor(){V(this,"player");V(this,"repeatModes",["NO_REPEAT","REPEAT_ALL","REPEAT_ONE"]);V(this,"initialized",!1)}init(e){this.initialized||(this.player=Lt.setup(e,{controls:[]})[0],this.listenToMediaEvents(this.player.media),this.setMediaSessionActionHandlers(),me(ee.volume,n=>this.player.setVolume(n),{immediate:!0}),this.initialized=!0)}registerPlay(e){ot.add(e),j.registerPlay(e),e.play_count_registered=!0}preload(e){const n=document.createElement("audio");n.setAttribute("src",j.getSourceUrl(e)),n.setAttribute("preload","auto"),n.load(),e.preloaded=!0}async play(e){if(e.deleted){this.next&&this.next.id!==e.id&&await this.playNext();return}x.current&&(x.current.playback_state="Stopped"),e.playback_state="Playing",await this.setNowPlayingMeta(e),this.player.media.src=j.getSourceUrl(e),await this.restart()}async setNowPlayingMeta(e){document.title=`${e.title} \u266B Koel`,this.player.media.setAttribute("title",`${e.artist_name} - ${e.title}`),await Et.context.resume()}showNotification(e){if(T.notify)try{const n=new window.Notification(`\u266B ${e.title}`,{icon:e.album_cover,body:`${e.album_name} \u2013 ${e.artist_name}`});n.onclick=()=>window.focus(),window.setTimeout(()=>n.close(),5e3)}catch(n){ze.error(n)}!navigator.mediaSession||(navigator.mediaSession.metadata=new MediaMetadata({title:e.title,artist:e.artist_name,album:e.album_name,artwork:[48,64,96,128,192,256,384,512].map(n=>({src:e.album_cover,sizes:`${n}x${n}`,type:"image/png"}))}))}setCurrentSongAndPlaybackPosition(e,n){x.current&&(x.current.playback_state="Stopped"),e.playback_state="Paused",this.player.media.src=j.getSourceUrl(e),this.player.seek(n),this.player.pause()}recordStartTime(e){e.play_start_time=Math.floor(Date.now()/1e3),e.play_count_registered=!1}broadcastSong(e){te.broadcast("SOCKET_SONG",e)}async restart(){const e=x.current;this.recordStartTime(e),this.broadcastSong(e);try{Ue.silently.put("queue/playback-status",{song:e.id,position:0})}catch(n){console.log(n)}this.player.restart();try{await this.player.media.play(),navigator.mediaSession&&(navigator.mediaSession.playbackState="playing"),this.showNotification(e)}catch{}}get isTranscoding(){return At.any&&T.transcodeOnMobile}get next(){if(x.next)return x.next;if(T.repeatMode==="REPEAT_ALL")return x.first}get previous(){if(x.previous)return x.previous;if(T.repeatMode==="REPEAT_ALL")return x.last}changeRepeatMode(){let e=this.repeatModes.indexOf(T.repeatMode)+1;e>=this.repeatModes.length&&(e=0),T.repeatMode=this.repeatModes[e]}async playPrev(){if(this.player.media.currentTime>5&&x.current.length>5){this.player.restart();return}!this.previous&&T.repeatMode==="NO_REPEAT"?await this.stop():this.previous&&await this.play(this.previous)}async playNext(){!this.next&&T.repeatMode==="NO_REPEAT"?await this.stop():this.next&&await this.play(this.next)}async stop(){document.title="Koel",this.player.pause(),this.player.seek(0),x.current&&(x.current.playback_state="Stopped"),navigator.mediaSession&&(navigator.mediaSession.playbackState="none"),te.broadcast("SOCKET_PLAYBACK_STOPPED")}pause(){this.player.pause(),x.current.playback_state="Paused",navigator.mediaSession&&(navigator.mediaSession.playbackState="paused"),te.broadcast("SOCKET_SONG",x.current)}async resume(){const e=x.current;this.player.media.src||(this.player.media.src=j.getSourceUrl(e),this.player.seek(xe.state.queue_state.playback_position),await this.setNowPlayingMeta(x.current),this.recordStartTime(e));try{await this.player.media.play()}catch(n){ze.error(n)}x.current.playback_state="Playing",navigator.mediaSession&&(navigator.mediaSession.playbackState="playing"),this.broadcastSong(e)}async toggle(){if(!x.current){await this.playFirstInQueue();return}if(x.current.playback_state!=="Playing"){await this.resume();return}this.pause()}async queueAndPlay(e,n=!1){e=Pt(e),n&&(e=Me.exports.shuffle(e)),await this.stop(),x.replaceQueueWith(e),await this.play(x.first)}async playFirstInQueue(){x.all.length&&await this.play(x.first)}setMediaSessionActionHandlers(){!navigator.mediaSession||(navigator.mediaSession.setActionHandler("play",()=>this.resume()),navigator.mediaSession.setActionHandler("pause",()=>this.pause()),navigator.mediaSession.setActionHandler("stop",()=>this.stop()),navigator.mediaSession.setActionHandler("previoustrack",()=>this.playPrev()),navigator.mediaSession.setActionHandler("nexttrack",()=>this.playNext()),navigator.mediaSession.setActionHandler("seekbackward",e=>{this.player.media.currentTime-=e.seekOffset||10}),navigator.mediaSession.setActionHandler("seekforward",e=>{this.player.media.currentTime+=e.seekOffset||10}),navigator.mediaSession.setActionHandler("seekto",e=>{if(e.fastSeek&&"fastSeek"in this.player.media){this.player.media.fastSeek(e.seekTime||0);return}this.player.media.currentTime=e.seekTime||0}))}listenToMediaEvents(e){e.addEventListener("error",()=>this.playNext(),!0),e.addEventListener("ended",()=>{xe.state.use_last_fm&&fe.current.preferences.lastfm_session_key&&j.scrobble(x.current),T.repeatMode==="REPEAT_ONE"?this.restart():this.playNext()});let n=()=>{const o=x.current;if(!o)return;if(!o.play_count_registered&&!this.isTranscoding&&(!e.duration||e.currentTime*4>=e.duration)&&this.registerPlay(o),Math.ceil(e.currentTime)%5===0)try{Ue.silently.put("queue/playback-status",{song:o.id,position:Math.ceil(e.currentTime)})}catch(a){console.log(a)}const s=x.next;!s||s.preloaded||this.isTranscoding||e.duration&&e.currentTime+ao>e.duration&&this.preload(s)};n=Me.exports.throttle(n,1e3),e.addEventListener("timeupdate",n)}}const W=new io,Et={unlocked:!1,context:null,source:null,element:null,preampGainNode:null,analyzer:null,bands:[],init(t){this.element=t,this.context=new AudioContext,this.preampGainNode=this.context.createGain(),this.source=this.context.createMediaElementSource(this.element),this.analyzer=this.context.createAnalyser(),this.source.connect(this.preampGainNode);const e=lo.getConfig();this.changePreampGain(e.preamp);let n;tt.forEach((o,s)=>{const a=this.context.createBiquadFilter();s===0?a.type="lowshelf":s===tt.length-1?a.type="highshelf":a.type="peaking",a.Q.setTargetAtTime(1,this.context.currentTime,.01),a.frequency.setTargetAtTime(o,this.context.currentTime,.01),a.gain.value=Ie(e.gains[s]),n?n.connect(a):this.preampGainNode.connect(a),n=a,this.bands.push({filter:a,label:String(o).replace("000","K"),db:e.gains[s]})}),n.connect(this.analyzer),this.analyzer.connect(this.context.destination),this.unlockAudioContext()},changePreampGain(t){this.preampGainNode.gain.value=Ie(t)},changeFilterGain(t,e){this.bands.find(n=>n.filter===t).db=e,t.gain.value=Ie(e)},unlockAudioContext(){["touchend","touchstart","click"].forEach(t=>{document.addEventListener(t,()=>{if(this.unlocked)return;const e=this.context.createBufferSource();e.buffer=this.context.createBuffer(1,1,22050),e.connect(this.context.destination),e.start(0),this.unlocked=!0},{once:!0})})}},ro={listen:()=>{te.listen("SOCKET_TOGGLE_PLAYBACK",()=>W.toggle()).listen("SOCKET_PLAY_NEXT",()=>W.playNext()).listen("SOCKET_PLAY_PREV",()=>W.playPrev()).listen("SOCKET_GET_STATUS",()=>{te.broadcast("SOCKET_STATUS",{song:x.current,volume:ee.get()})}).listen("SOCKET_GET_CURRENT_SONG",()=>te.broadcast("SOCKET_SONG",x.current)).listen("SOCKET_SET_VOLUME",t=>ee.set(t)).listen("SOCKET_TOGGLE_FAVORITE",()=>x.current&&De.toggleOne(x.current))}};class co{constructor(){V(this,"input");V(this,"volume",k(0))}init(e){this.input=e,this.set(T.volume)}get(){return this.volume.value}set(e,n=!0){n&&(T.volume=e),this.volume.value=e,this.input.value=String(e)}mute(){this.set(0,!1)}unmute(){this.set(T.volume)}}const ee=new co,lo={getPresetById(t){return et.find(e=>e.id===t)},getConfig(){return T.equalizer.id===-1?T.equalizer:this.getPresetById(T.equalizer.id)||et[0]},saveConfig(t,e,n){const o=this.getPresetById(t);T.equalizer=o||{preamp:e,gains:n,id:-1,name:"Custom"}}},uo=[{path:"/home",screen:"Home"},{path:"/404",screen:"404"},{path:"/queue",screen:"Queue"},{path:"/songs",screen:"Songs"},{path:"/albums",screen:"Albums"},{path:"/artists",screen:"Artists"},{path:"/favorites",screen:"Favorites"},{path:"/recently-played",screen:"RecentlyPlayed"},{path:"/search",screen:"Search.Excerpt"},{path:"/search/songs",screen:"Search.Songs"},{path:"/upload",screen:"Upload",onResolve:()=>{var t;return(t=fe.current)==null?void 0:t.is_admin}},{path:"/settings",screen:"Settings",onResolve:()=>{var t;return(t=fe.current)==null?void 0:t.is_admin}},{path:"/users",screen:"Users",onResolve:()=>{var t;return(t=fe.current)==null?void 0:t.is_admin}},{path:"/youtube",screen:"YouTube"},{path:"/profile",screen:"Profile"},{path:"visualizer",screen:"Visualizer"},{path:"/album/(?<id>\\d+)",screen:"Album"},{path:"/artist/(?<id>\\d+)",screen:"Artist"},{path:"/playlist/(?<id>\\d+)",screen:"Playlist"},{path:"/genres",screen:"Genres"},{path:"/genres/(?<name>.+)",screen:"Genre"},{path:"/visualizer",screen:"Visualizer"},{path:"/song/(?<id>[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})",screen:"Queue",redirect:()=>"queue",onResolve:t=>de.emit("SONG_QUEUED_FROM_ROUTE",t.id)},{path:"/invitation/accept/(?<token>[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})",screen:"Invitation.Accept"}],et=[{id:0,name:"Default",preamp:0,gains:[0,0,0,0,0,0,0,0,0,0]},{id:1,name:"Classical",preamp:-1,gains:[-1,-1,-1,-1,-1,-1,-7,-7,-7,-9]},{id:2,name:"Club",preamp:-6.7,gains:[-1,-1,8,5,5,5,3,-1,-1,-1]},{id:3,name:"Dance",preamp:-4.3,gains:[9,7,2,-1,-1,-5,-7,-7,-1,-1]},{id:4,name:"Full Bass",preamp:-7.2,gains:[-8,9,9,5,1,-4,-8,-10,-11,-11]},{id:5,name:"Full Treble",preamp:-12,gains:[-9,-9,-9,-4,2,11,16,16,16,16]},{id:6,name:"Headphone",preamp:-8,gains:[4,11,5,-3,-2,1,4,9,12,14]},{id:7,name:"Large Hall",preamp:-7.2,gains:[10,10,5,5,-1,-4,-4,-4,-1,-1]},{id:8,name:"Live",preamp:-5.3,gains:[-4,-1,4,5,5,5,4,2,2,2]},{id:9,name:"Pop",preamp:-6.2,gains:[-1,4,7,8,5,-1,-2,-2,-1,-1]},{id:10,name:"Reggae",preamp:-8.2,gains:[-1,-1,-1,-5,-1,6,6,-1,-1,-1]},{id:11,name:"Rock",preamp:-10,gains:[8,4,-5,-8,-3,4,8,11,11,11]},{id:12,name:"Soft Rock",preamp:-5.3,gains:[4,4,2,-1,-4,-5,-3,-1,2,8]},{id:13,name:"Techno",preamp:-7.7,gains:[8,5,-1,-5,-4,-1,8,9,9,8]}],tt=[60,170,310,600,1e3,3e3,6e3,12e3,14e3,16e3];class po{constructor(e){V(this,"$currentRoute");V(this,"routes");V(this,"homeRoute");V(this,"notFoundRoute");V(this,"routeChangedHandlers",[]);V(this,"cache",new Map);this.routes=e,this.homeRoute=e.find(n=>n.screen==="Home"),this.notFoundRoute=e.find(n=>n.screen==="404"),this.$currentRoute=k(this.homeRoute),me(this.$currentRoute,(n,o)=>this.routeChangedHandlers.forEach(async s=>await s(n,o)),{deep:!0,immediate:!0}),addEventListener("popstate",()=>this.resolve(),!0)}async resolve(){var s;if(!location.hash||location.hash==="#/"||location.hash==="#!/")return this.go(this.homeRoute.path);const e=this.tryMatchRoute(),[n,o]=e?[e.route,e.params]:[null,null];if(!n)return this.triggerNotFound();if(((s=n.onResolve)==null?void 0:s.call(n,o))===!1)return this.triggerNotFound();if(n.redirect){const a=n.redirect(o);return typeof a=="string"?this.go(a):this.activateRoute(a,o)}return this.activateRoute(n,o)}tryMatchRoute(){if(!this.cache.has(location.hash))for(let e=0;e<this.routes.length;e++){const n=this.routes[e],o=location.hash.match(new RegExp(`^#!?${n.path}/?(?:\\?(.*))?$`));if(o){const s=new URLSearchParams(new URL(location.href.replace("#/","")).search);this.cache.set(location.hash,{route:n,params:Object.assign(Object.fromEntries(s.entries()),o.groups||{})});break}}return this.cache.get(location.hash)}async triggerNotFound(){await this.activateRoute(this.notFoundRoute)}onRouteChanged(e){this.routeChangedHandlers.push(e)}async activateRoute(e,n={}){this.$currentRoute.value=e,this.$currentRoute.value.params=n}go(e){if(typeof e=="number"){history.go(e);return}e.startsWith("/")||(e=`/${e}`),e.startsWith("/#")||(e=`/#${e}`),e=e.substring(1,e.length),location.assign(`${location.origin}${location.pathname}${e}`)}}let B;const fo=()=>(B=B||ue(xt),{showSuccessDialog:B.value.success.bind(B.value),showInfoDialog:B.value.info.bind(B.value),showWarningDialog:B.value.warning.bind(B.value),showErrorDialog:B.value.error.bind(B.value),showConfirmDialog:B.value.confirm.bind(B.value)});let q;const _o=()=>(q=q||ue(St),{toastSuccess:q.value.success.bind(q.value),toastInfo:q.value.info.bind(q.value),toastWarning:q.value.warning.bind(q.value),toastError:q.value.error.bind(q.value)}),mo=()=>{const t=k(navigator.onLine),e=U(()=>!t.value),n=()=>t.value=navigator.onLine;return window.addEventListener("online",n),window.addEventListener("offline",n),Ot(()=>{window.removeEventListener("online",n),window.removeEventListener("offline",n)}),{online:t,offline:e}};var kt={exports:{}};(function(t,e){(function(n,o){t.exports=o()})($t,function(){var n=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function o(r,f){return r.indexOf(f)===-1?r.length:r.indexOf(f)}function s(r){var f=r.replace(/^v/,"").replace(/\+.*$/,""),h=o(f,"-"),_=f.substring(0,h).split(".");return _.push(f.substring(h+1)),_}function a(r){return isNaN(Number(r))?r:Number(r)}function c(r){if(typeof r!="string")throw new TypeError("Invalid argument expected string");if(!n.test(r))throw new Error("Invalid argument not valid semver ('"+r+"' received)")}function i(r,f){[r,f].forEach(c);for(var h=s(r),_=s(f),v=0;v<Math.max(h.length-1,_.length-1);v++){var y=parseInt(h[v]||0,10),w=parseInt(_[v]||0,10);if(y>w)return 1;if(w>y)return-1}var b=h[h.length-1],A=_[_.length-1];if(b&&A){var S=b.split(".").map(a),O=A.split(".").map(a);for(v=0;v<Math.max(S.length,O.length);v++){if(S[v]===void 0||typeof O[v]=="string"&&typeof S[v]=="number")return-1;if(O[v]===void 0||typeof S[v]=="string"&&typeof O[v]=="number"||S[v]>O[v])return 1;if(O[v]>S[v])return-1}}else if(b||A)return b?-1:1;return 0}var d=[">",">=","=","<","<="],u={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function l(r){if(typeof r!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof r);if(d.indexOf(r)===-1)throw new TypeError("Invalid operator, expected one of "+d.join("|"))}return i.validate=function(r){return typeof r=="string"&&n.test(r)},i.compare=function(r,f,h){l(h);var _=i(r,f);return u[h].indexOf(_)>-1},i})})(kt);const Is=kt.exports;let I;const $e=()=>{I=I||ue(bt);const t=s=>{var a,c;return(c=(a=I.$currentRoute.value)==null?void 0:a.params)==null?void 0:c[s]},e=()=>{var s;return(s=I.$currentRoute.value)==null?void 0:s.screen},n=(...s)=>{var a;return s.includes((a=I.$currentRoute.value)==null?void 0:a.screen)};return{getRouteParam:t,getCurrentScreen:e,isCurrentScreen:n,onScreenActivated:(s,a)=>{n(s)&&a(),I.onRouteChanged(c=>c.screen===s&&a())},go:I.go.bind(I),onRouteChanged:I.onRouteChanged.bind(I),resolveRoute:I.resolve.bind(I),triggerNotFound:I.triggerNotFound.bind(I)}};const ho=["title","onClick"],go=$({__name:"SongLikeButton",props:{song:{}},setup(t){const e=t,{song:n}=st(e),o=U(()=>`${n.value.liked?"Unlike":"Like"} ${n.value.title} by ${n.value.artist_name}`),s=()=>De.toggleOne(n.value);return(a,c)=>{const i=G("Icon");return m(),E("button",{title:o.value,type:"button",onClick:z(s,["stop"])},[p(n).liked?(m(),C(i,{key:0,icon:p(It)},null,8,["icon"])):(m(),C(i,{key:1,icon:p(Mt)},null,8,["icon"]))],8,ho)}}});const vo={class:"content"},yo={key:0,class:"title"},wo={class:"message"},bo=$({__name:"DialogBox",setup(t,{expose:e}){const n=k(),o=k("info"),s=k(""),a=k(""),c=U(()=>o.value==="confirm"),i=()=>{var y;return(y=n.value)==null?void 0:y.close()},d=()=>{var y;return(y=n.value)==null?void 0:y.dispatchEvent(new Event("cancel"))},u=()=>new Promise(y=>{var w,b;(w=n.value)==null||w.addEventListener("cancel",()=>{i(),y(!1)},{once:!0}),(b=n.value)==null||b.querySelector("[name=ok]").addEventListener("click",()=>{i(),y(!0)},{once:!0})}),l=async(y,w,b="")=>(o.value=y,a.value=w,s.value=b,n.value.showModal(),u());return e({success:async(y,w="")=>l("success",y,w),info:async(y,w="")=>l("info",y,w),warning:async(y,w="")=>l("warning",y,w),error:async(y,w="")=>l("danger",y,w),confirm:async(y,w="")=>l("confirm",y,w)}),(y,w)=>{const b=G("Icon");return m(),E("dialog",{ref_key:"dialog",ref:n,class:ae(["dialog",`dialog-${o.value}`])},[R("main",null,[R("aside",null,[o.value==="info"?(m(),C(b,{key:0,icon:p(Nt)},null,8,["icon"])):L("",!0),o.value==="success"?(m(),C(b,{key:1,icon:p(Dt)},null,8,["icon"])):L("",!0),o.value==="warning"?(m(),C(b,{key:2,icon:p(at)},null,8,["icon"])):L("",!0),o.value==="danger"?(m(),C(b,{key:3,icon:p(Ft)},null,8,["icon"])):L("",!0),o.value==="confirm"?(m(),C(b,{key:4,icon:p(Vt)},null,8,["icon"])):L("",!0)]),R("div",vo,[s.value?(m(),E("h3",yo,he(s.value),1)):L("",!0),R("div",wo,he(a.value),1)])]),R("footer",null,[c.value?(m(),C(Ke,{key:0,name:"cancel",onClick:z(d,["prevent"])},{default:ge(()=>[Ge("Cancel")]),_:1},8,["onClick"])):L("",!0),g(Ke,{name:"ok"},{default:ge(()=>[Ge("OK")]),_:1})])],2)}}});const xo=H(bo,[["__scopeId","data-v-b37facad"]]),So=$({__name:"MessageToast",props:{message:{}},emits:["dismiss"],setup(t,{emit:e}){const n=t,{message:o}=st(n),s=U(()=>{switch(o.value.type){case"info":return ct;case"success":return rt;case"warning":return at;default:return it}});let a;const c=()=>{e("dismiss",o.value),window.clearTimeout(a)};return Re(()=>{a=window.setTimeout(()=>c(),o.value.timeout*1e3)}),(i,d)=>{const u=G("Icon");return m(),E("div",{class:ae([p(o).type,"message"]),title:"Click to dismiss",onClick:c},[R("aside",null,[g(u,{icon:s.value,class:"icon"},null,8,["icon"]),g(u,{icon:p(Bt),class:"icon-dismiss"},null,8,["icon"])]),R("main",null,he(p(o).content),1)],2)}}});const Eo=H(So,[["__scopeId","data-v-1eb9a942"]]),ko=$({__name:"MessageToaster",setup(t,{expose:e}){const n=k([]),o=(u,l,r=5)=>{n.value.push({type:u,content:l,timeout:r,id:Ut()})},s=u=>{n.value=n.value.filter(l=>l.id!==u.id)};return e({info:(u,l)=>o("info",u,l),success:(u,l)=>o("success",u,l),warning:(u,l)=>o("warning",u,l),error:(u,l)=>o("danger",u,l)}),(u,l)=>(m(),C(Ht,{name:"toast",tag:"ul"},{default:ge(()=>[(m(!0),E(lt,null,zt(n.value,r=>(m(),E("li",{key:r.id},[g(Eo,{message:r,onDismiss:f=>s(r)},null,8,["message","onDismiss"])]))),128))]),_:1}))}});const To=H(ko,[["__scopeId","data-v-21046536"]]),Co=["onCancel"],Ro={class:"wrapper"},Lo=["innerHTML"],Ao=$({__name:"Overlay",setup(t,{expose:e}){const n=M(()=>N(()=>import("./SoundBars.e7c8d9da.js"),["assets/SoundBars.e7c8d9da.js","assets/_plugin-vue_export-helper.cdc0426e.js","assets/index.8f0bf197.js","assets/Btn.abe2bb59.js","assets/Btn.535c40ae.css"])),o=k(),s=Gt({dismissible:!1,type:"loading",message:""}),a=(d={})=>{var u,l;Object.assign(s,d),(u=o.value)!=null&&u.open||((l=o.value)==null||l.showModal())},c=()=>{var d;return(d=o.value)==null?void 0:d.close()},i=()=>s.dismissible&&c();return e({show:a,hide:c}),(d,u)=>{const l=G("Icon");return m(),E("dialog",{ref_key:"el",ref:o,class:ae(s.type),"data-testid":"overlay",onCancel:z(i,["prevent"])},[R("div",Ro,[s.type==="loading"?(m(),C(p(n),{key:0})):L("",!0),s.type==="error"?(m(),C(l,{key:1,icon:p(it)},null,8,["icon"])):L("",!0),s.type==="warning"?(m(),C(l,{key:2,icon:p(Kt)},null,8,["icon"])):L("",!0),s.type==="info"?(m(),C(l,{key:3,icon:p(ct)},null,8,["icon"])):L("",!0),s.type==="success"?(m(),C(l,{key:4,icon:p(rt)},null,8,["icon"])):L("",!0),R("span",{class:"message",innerHTML:s.message},null,8,Lo)])],42,Co)}}});const Po=H(Ao,[["__scopeId","data-v-b6160ebd"]]),Oo=t=>(jt("data-v-efdc04cf"),t=t(),Yt(),t),$o={class:"offline"},Io=Oo(()=>R("span",{class:"text"},"You\u2019re offline.",-1)),Mo=$({__name:"OfflineNotification",setup(t){return(e,n)=>{const o=G("Icon"),s=G("IconLayers");return m(),E("div",$o,[g(s,{"fixed-width":""},{default:ge(()=>[g(o,{icon:p(qt),"fixed-width":"",size:"xl"},null,8,["icon"]),g(o,{icon:p(Wt),"fixed-width":"",size:"lg",transform:"up-2"},null,8,["icon"])]),_:1}),Io])}}});const No=H(Mo,[["__scopeId","data-v-efdc04cf"]]);const Do={},Fo={class:"plyr"},Vo=R("audio",{controls:"",crossorigin:"anonymous"},null,-1),Bo=[Vo];function Ho(t,e){return m(),E("div",Fo,Bo)}const zo=H(Do,[["render",Ho]]),Uo={key:0,class:"meta"},Go={class:"title"},Ko=["href"],qo=$({__name:"FooterSongInfo",setup(t){const e=ue(we,k()),n=U(()=>{var o;return((o=e.value)==null?void 0:o.album_cover)||Qt});return(o,s)=>{var a;return m(),E("div",{class:ae(["song-info",{playing:((a=p(e))==null?void 0:a.playback_state)==="Playing"}])},[R("span",{style:ut({backgroundImage:`url('${n.value}')`}),class:"album-thumb"},null,4),p(e)?(m(),E("div",Uo,[R("h3",Go,he(p(e).title),1),R("a",{href:`/#/artist/${p(e).artist_id}`,class:"artist"},he(p(e).artist_name),9,Ko)])):L("",!0)],2)}}});const Wo=H(qo,[["__scopeId","data-v-8f60970d"]]),jo=$({__name:"Volume",setup(t){const e=ee.volume,n=U(()=>e.value===0?"muted":e.value<3?"discreet":"loud"),o=()=>ee.mute(),s=()=>ee.unmute(),a=i=>ee.set(parseFloat(i.target.value)),c=i=>{te.broadcast("SOCKET_VOLUME_CHANGED",parseFloat(i.target.value))};return(i,d)=>{const u=G("Icon"),l=Fe("koel-tooltip");return m(),E("span",{id:"volume",class:ae(["volume",n.value])},[ne((m(),E("span",{role:"button",tabindex:"0",title:"Unmute",onClick:s},[g(u,{icon:p(Xt),"fixed-width":""},null,8,["icon"])])),[[Se,n.value==="muted"],[l,void 0,void 0,{top:!0}]]),ne((m(),E("span",{role:"button",tabindex:"0",title:"Mute",onClick:o},[g(u,{icon:n.value==="discreet"?p(Zt):p(Jt),"fixed-width":""},null,8,["icon"])])),[[Se,n.value!=="muted"],[l,void 0,void 0,{top:!0}]]),R("input",{id:"volumeInput",class:"plyr__volume",max:"10",role:"slider",step:"0.1",title:"Volume",type:"range",onChange:c,onInput:a},null,32)],2)}}});const Yo={class:"extra-controls","data-testid":"other-controls"},Qo={class:"wrapper"},Xo=["onClick"],Zo=["onClick"],Jo=["title","onClick"],es=$({__name:"FooterExtraControls",setup(t){const e=k(!1),n=U(()=>e.value?"Exit fullscreen mode":"Enter fullscreen mode"),{go:o,isCurrentScreen:s}=$e(),a=()=>de.emit("MODAL_SHOW_EQUALIZER"),c=()=>de.emit("FULLSCREEN_TOGGLE"),i=()=>o(s("Visualizer")?-1:"visualizer");return Re(()=>{document.addEventListener("fullscreenchange",()=>{e.value=Boolean(document.fullscreenElement)})}),(d,u)=>{const l=G("Icon"),r=Fe("koel-tooltip");return m(),E("div",Yo,[R("div",Qo,[ne((m(),E("button",{class:"visualizer-btn","data-testid":"toggle-visualizer-btn",title:"Toggle visualizer",onClick:z(i,["prevent"])},[g(l,{icon:p(en)},null,8,["icon"])],8,Xo)),[[r,void 0,void 0,{top:!0}]]),p(Qn)?ne((m(),E("button",{key:0,class:ae([{active:a},"equalizer"]),title:"Show equalizer",type:"button",onClick:z(a,["prevent"])},[g(l,{icon:p(tn)},null,8,["icon"])],10,Zo)),[[r,void 0,void 0,{top:!0}]]):L("",!0),g(jo),p(Xn)()?ne((m(),E("button",{key:1,title:n.value,onClick:z(c,["prevent"])},[g(l,{icon:e.value?p(nn):p(on)},null,8,["icon"])],8,Jo)),[[r,void 0,void 0,{top:!0}]]):L("",!0)])])}}});const ts=H(es,[["__scopeId","data-v-93e47684"]]),ns=["title","onClick"],os=$({__name:"RepeatModeSwitch",setup(t){const e=sn(T.state,"repeatMode"),n=U(()=>e.value.split("_").map(s=>s[0].toUpperCase()+s.substring(1).toLowerCase()).join(" ")),o=()=>W.changeRepeatMode();return(s,a)=>{const c=G("Icon"),i=Fe("koel-tooltip");return ne((m(),E("button",{class:ae({active:e.value!=="NO_REPEAT"}),title:`Change repeat mode (current: ${n.value})`,"data-testid":"repeat-mode-switch",type:"button",onClick:z(o,["prevent"])},[g(p(dt),null,{default:ge(()=>[g(c,{icon:p(an)},null,8,["icon"]),e.value==="REPEAT_ONE"?(m(),C(p(rn),{key:0,counter:"",value:"1"})):L("",!0)]),_:1})],10,ns)),[[i,void 0,void 0,{top:!0}]])}}});const ss=H(os,[["__scopeId","data-v-7df75483"]]),as=["onClick"],is=$({__name:"FooterPlayButton",setup(t){const{getCurrentScreen:e,getRouteParam:n,go:o}=$e(),s=ue(we,k()),a=U(()=>xe.state.song_count===0),c=U(()=>{var u;return((u=s.value)==null?void 0:u.playback_state)==="Playing"}),i=async()=>s.value?W.toggle():d(),d=async()=>{if(a.value)return;let u;switch(e()){case"Album":u=await j.fetchForAlbum(parseInt(n("id")));break;case"Artist":u=await j.fetchForArtist(parseInt(n("id")));break;case"Playlist":u=await j.fetchForPlaylist(parseInt(n("id")));break;case"Favorites":u=await De.fetch();break;case"RecentlyPlayed":u=await ot.fetch();break;default:u=await x.fetchRandom();break}W.queueAndPlay(u),o("queue")};return(u,l)=>{const r=G("Icon");return m(),E("button",{type:"button",class:ae(c.value?"playing":"stopped"),title:"Play or resume",onClick:z(i,["prevent"])},[c.value?(m(),C(r,{key:0,icon:p(cn)},null,8,["icon"])):(m(),C(r,{key:1,icon:p(ln)},null,8,["icon"]))],10,as)}}});const rs=H(is,[["__scopeId","data-v-397bddf9"]]),cs={class:"playback-controls","data-testid":"footer-middle-pane"},ls={class:"buttons"},us={key:1,type:"button"},ds=["onClick"],ps=["onClick"],fs=$({__name:"FooterPlaybackControls",setup(t){const e=ue(we,k()),n=async()=>await W.playPrev(),o=async()=>await W.playNext();return(s,a)=>{const c=G("Icon");return m(),E("div",cs,[R("div",ls,[p(e)?(m(),C(go,{key:0,song:p(e),class:"like-btn"},null,8,["song"])):(m(),E("button",us)),R("button",{type:"button",title:"Play previous song",onClick:z(n,["prevent"])},[g(c,{icon:p(un)},null,8,["icon"])],8,ds),g(rs),R("button",{type:"button",title:"Play next song",onClick:z(o,["prevent"])},[g(c,{icon:p(dn)},null,8,["icon"])],8,ps),g(ss,{class:"repeat-mode-btn"})])])}}});const _s=H(fs,[["__scopeId","data-v-d538b39d"]]),ms=["onContextmenu"],hs={class:"wrapper"},gs=$({__name:"index",setup(t){const e=ue(we,k());let n;const o=k(),s=k(),a=l=>{document.fullscreenElement||e.value&&de.emit("SONG_CONTEXT_MENU_REQUESTED",l,e.value)};me(e,async()=>{!e.value||(s.value=await pn.resolve(e.value.artist_id))});const c=U(()=>{var r,f,h;const l=(h=(r=s.value)==null?void 0:r.image)!=null?h:(f=e.value)==null?void 0:f.album_cover;return{backgroundImage:l?`url(${l})`:"none"}}),i=async()=>{const l=document.querySelector(".plyr"),r=document.querySelector("#volumeInput");if(!l||!r){await pt(),await i();return}W.init(l),ee.init(r),Et.init(W.player.media)};me(T.initialized,async l=>{!l||await i()},{immediate:!0});const d=()=>{n=window.setTimeout(()=>{var l;return(l=o.value)==null?void 0:l.classList.add("hide-controls")},5e3)},u=Me.exports.throttle(()=>{var l;!document.fullscreenElement||((l=o.value)==null||l.classList.remove("hide-controls"),window.clearTimeout(n),d())},100);return de.on("FULLSCREEN_TOGGLE",()=>{var l,r;document.fullscreenElement?(document.exitFullscreen(),(l=o.value)==null||l.classList.remove("hide-controls")):((r=o.value)==null||r.requestFullscreen(),d())}),(l,r)=>(m(),E("footer",{id:"mainFooter",ref_key:"root",ref:o,onContextmenu:z(a,["prevent"]),onMousemove:r[0]||(r[0]=(...f)=>p(u)&&p(u)(...f))},[ne(g(zo,null,null,512),[[Se,p(e)]]),R("div",{class:"fullscreen-backdrop",style:ut(c.value)},null,4),R("div",hs,[g(Wo),g(_s),g(ts)])],40,ms))}});const vs=H(gs,[["__scopeId","data-v-89cb7add"]]),ys=$({setup(t,{slots:e}){let n,o,s;return Re(()=>{n=_o().toastSuccess,o=fo().showConfirmDialog,s=$e().go}),de.on("PLAYLIST_DELETE",async a=>{await o(`Delete the playlist "${a.name}"?`)&&(await fn.delete(a),n(`Playlist "${a.name}" deleted.`),s("home"))}).on("PLAYLIST_FOLDER_DELETE",async a=>{await o(`Delete the playlist folder "${a.name}"?`)&&(await _n.delete(a),n(`Playlist folder "${a.name}" deleted.`),s("home"))}).on("LOG_OUT",async()=>{await fe.logout(),ft.destroy(),yn()}),()=>{var a;return(a=e.default)==null?void 0:a.call(e)}}}),ws=$({__name:"App",setup(t){const e=M(()=>N(()=>import("./HotkeyListener.e84cf9f1.js"),["assets/HotkeyListener.e84cf9f1.js","assets/index.8f0bf197.js","assets/Btn.abe2bb59.js","assets/Btn.535c40ae.css","assets/_plugin-vue_export-helper.cdc0426e.js"])),n=M(()=>N(()=>import("./LoginForm.12838887.js"),["assets/LoginForm.12838887.js","assets/LoginForm.755cf9db.css","assets/index.8f0bf197.js","assets/logo.cf71f526.js","assets/Btn.abe2bb59.js","assets/Btn.535c40ae.css","assets/_plugin-vue_export-helper.cdc0426e.js","assets/PasswordField.1e406e0f.js","assets/PasswordField.51a1cd8b.css"])),o=M(()=>N(()=>import("./index.f07e8060.js").then(P=>P.j),["assets/index.f07e8060.js","assets/index.5481f61c.css","assets/index.8f0bf197.js","assets/useAuthorization.5beda362.js","assets/Btn.abe2bb59.js","assets/Btn.535c40ae.css","assets/_plugin-vue_export-helper.cdc0426e.js","assets/useSongMenuMethods.5f7dfc3e.js","assets/downloadService.40931a22.js","assets/SoundBars.e7c8d9da.js","assets/useUpload.8e7c76aa.js"])),s=M(()=>N(()=>import("./AlbumContextMenu.e8282060.js"),["assets/AlbumContextMenu.e8282060.js","assets/index.8f0bf197.js","assets/downloadService.40931a22.js","assets/useContextMenu.bb260cc5.js","assets/_plugin-vue_export-helper.cdc0426e.js","assets/Btn.abe2bb59.js","assets/Btn.535c40ae.css"])),a=M(()=>N(()=>import("./ArtistContextMenu.074e8abb.js"),["assets/ArtistContextMenu.074e8abb.js","assets/index.8f0bf197.js","assets/downloadService.40931a22.js","assets/useContextMenu.bb260cc5.js","assets/_plugin-vue_export-helper.cdc0426e.js","assets/Btn.abe2bb59.js","assets/Btn.535c40ae.css"])),c=M(()=>N(()=>import("./PlaylistContextMenu.ad252294.js"),["assets/PlaylistContextMenu.ad252294.js","assets/index.8f0bf197.js","assets/useContextMenu.bb260cc5.js","assets/_plugin-vue_export-helper.cdc0426e.js","assets/Btn.abe2bb59.js","assets/Btn.535c40ae.css"])),i=M(()=>N(()=>import("./PlaylistFolderContextMenu.30dafdf3.js"),["assets/PlaylistFolderContextMenu.30dafdf3.js","assets/index.8f0bf197.js","assets/useContextMenu.bb260cc5.js","assets/_plugin-vue_export-helper.cdc0426e.js","assets/Btn.abe2bb59.js","assets/Btn.535c40ae.css"])),d=M(()=>N(()=>import("./SongContextMenu.7fc6a429.js"),["assets/SongContextMenu.7fc6a429.js","assets/SongContextMenu.0966efbe.css","assets/index.8f0bf197.js","assets/Btn.abe2bb59.js","assets/Btn.535c40ae.css","assets/_plugin-vue_export-helper.cdc0426e.js","assets/downloadService.40931a22.js","assets/useAuthorization.5beda362.js","assets/useContextMenu.bb260cc5.js","assets/useSongMenuMethods.5f7dfc3e.js"])),u=M(()=>N(()=>import("./CreateNewPlaylistContextMenu.447498c6.js"),["assets/CreateNewPlaylistContextMenu.447498c6.js","assets/index.8f0bf197.js","assets/useContextMenu.bb260cc5.js","assets/_plugin-vue_export-helper.cdc0426e.js","assets/Btn.abe2bb59.js","assets/Btn.535c40ae.css"])),l=M(()=>N(()=>import("./SupportKoel.1af604ed.js"),["assets/SupportKoel.1af604ed.js","assets/SupportKoel.982aa285.css","assets/index.8f0bf197.js","assets/_plugin-vue_export-helper.cdc0426e.js"])),r=M(()=>N(()=>import("./DropZone.e24dc243.js"),["assets/DropZone.e24dc243.js","assets/DropZone.8092a43b.css","assets/index.8f0bf197.js","assets/Btn.abe2bb59.js","assets/Btn.535c40ae.css","assets/_plugin-vue_export-helper.cdc0426e.js","assets/useUpload.8e7c76aa.js","assets/useAuthorization.5beda362.js"])),f=M(()=>N(()=>import("./AcceptInvitation.258376f9.js"),["assets/AcceptInvitation.258376f9.js","assets/AcceptInvitation.ca77158f.css","assets/index.8f0bf197.js","assets/invitationService.3ec71d57.js","assets/Btn.abe2bb59.js","assets/Btn.535c40ae.css","assets/_plugin-vue_export-helper.cdc0426e.js","assets/PasswordField.1e406e0f.js","assets/PasswordField.51a1cd8b.css"])),h=k(),_=k(),v=k(),y=k(),w=k(!1),b=k(),{isCurrentScreen:A,resolveRoute:S}=$e(),{offline:O}=mo(),Z=async()=>{T.notify&&window.Notification&&window.Notification.permission!=="granted"&&(T.notify=await window.Notification.requestPermission()==="denied")},re=async()=>{b.value="main",await D()};Re(async()=>{ft.hasApiToken()?(await D(),await S(),b.value="main"):(await S(),b.value=A("Invitation.Accept")?"invitation":"auth"),document.documentElement.classList.add(navigator.userAgent.includes("Mac")?"mac":"non-mac")});const D=async()=>{h.value.show({message:"Just a little patience\u2026"});try{await xe.init(),await pt(),await Z(),window.addEventListener("beforeunload",P=>{(mn.shouldWarnUponWindowUnload()||T.confirmClosing)&&(P.preventDefault(),P.returnValue="")}),await te.init()&&ro.listen()}catch(P){throw b.value="auth",P}finally{h.value.hide()}},F=P=>{var J;w.value=Boolean((J=P.dataTransfer)==null?void 0:J.types.includes("Files"))&&!A("Upload")};me(()=>x.current,P=>y.value=P);const ce=()=>w.value=!1,le=()=>w.value=!1;return be(so,h),be(xt,_),be(St,v),be(we,y),(P,J)=>(m(),E(lt,null,[g(Po,{ref_key:"overlay",ref:h},null,512),g(xo,{ref_key:"dialog",ref:_},null,512),g(To,{ref_key:"toaster",ref:v},null,512),g(p(ys)),p(O)?(m(),C(No,{key:0})):L("",!0),b.value==="main"?(m(),E("div",{key:1,id:"main",onDragend:ce,onDragover:F,onDrop:le},[g(p(e)),g(p(o)),g(vs),g(p(l)),g(p(d)),g(p(s)),g(p(a)),g(p(c)),g(p(i)),g(p(u)),ne(g(p(r),null,null,512),[[Se,w.value]])],32)):L("",!0),b.value==="auth"?(m(),C(p(n),{key:2,onLoggedin:re})):L("",!0),b.value==="invitation"?(m(),C(p(f),{key:3})):L("",!0)],64))}});hn(ws).provide(bt,new po(uo)).component("Icon",gn).component("IconLayers",dt).directive("koel-focus",wn).directive("koel-clickaway",vn).directive("koel-tooltip",eo).directive("koel-hide-broken-icon",to).directive("koel-overflow-fade",oo).mount("#app");var nt;(nt=navigator.serviceWorker)==null||nt.register("./sw.js");export{we as C,$s as M,so as O,Cs as S,go as _,jn as a,Cn as b,Is as c,Rs as d,As as e,ks as f,Ps as g,Ls as h,Os as i,$e as j,_o as k,fo as l,Ts as m,Et as n,$n as o,W as p,lo as q,et as r,Zn as u};
