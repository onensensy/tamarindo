import{v as T,j as h,aj as A,au as U,y as $,a9 as q,z as l,C as g,O as c,B as s,G as e,R as n,aa as w,aH as z,bI as H,A as v,Y as C,N as L,Z as k,P as d,bB as Y,F as _,aG as Z,at as J,l as Q}from"./index.8f0bf197.js";import{k as W,l as X,j as ee}from"./app.be92839b.js";import{u as oe}from"./useModal.8598f864.js";import{u as se}from"./useOverlay.b8f8c136.js";import{u as te}from"./useSmartPlaylistForm.7df2de33.js";import"./Btn.abe2bb59.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./SoundBars.e7c8d9da.js";const ae=["onSubmit","onKeydown"],le=e("header",null,[e("h1",null,"New Smart Playlist")],-1),ne={class:"form-row cols"},re={class:"name"},ie={class:"folder"},ue=e("option",{value:null},null,-1),ce=["value"],de={class:"form-row rules"},Ce=T({__name:"CreateSmartPlaylistForm",emits:["close"],setup(me,{emit:S}){const{Btn:m,FormBase:b,RuleGroup:B,collectedRuleGroups:p,addGroup:P,onGroupChanged:x}=te(),{showOverlay:D,hideOverlay:G}=se(),{toastSuccess:I}=W(),{showConfirmDialog:N,showErrorDialog:F}=X(),{go:M}=ee(),t=oe().getFromContext("folder"),r=h(""),i=h(t==null?void 0:t.id),R=A(U.state,"folders"),f=()=>S("close"),V=()=>r.value===""&&i.value===(t==null?void 0:t.id)&&p.value.length===0,y=async()=>{if(V()){f();return}await N("Discard all changes?")&&f()},O=async()=>{D();try{const a=await J.store(r.value,{rules:p.value,folder_id:i.value});f(),I(`Playlist "${a.name}" created.`),M(`playlist/${a.id}`)}catch(a){F("Something went wrong. Please try again.","Error"),Q.error(a)}finally{G()}};return(a,u)=>{const j=$("Icon"),E=q("koel-focus");return l(),g(s(b),null,{default:c(()=>[e("form",{onSubmit:_(O,["prevent"]),onKeydown:Z(y,["esc"])},[le,e("main",null,[e("div",ne,[e("label",re,[n(" Name "),w(e("input",{"onUpdate:modelValue":u[0]||(u[0]=o=>r.value=o),name:"name",placeholder:"Playlist name",required:"",type:"text"},null,512),[[z,r.value],[E]])]),e("label",ie,[n(" Folder "),w(e("select",{"onUpdate:modelValue":u[1]||(u[1]=o=>i.value=o)},[ue,(l(!0),v(k,null,C(R.value,o=>(l(),v("option",{key:o.id,value:o.id},L(o.name),9,ce))),128))],512),[[H,i.value]])])]),e("div",de,[(l(!0),v(k,null,C(s(p),(o,K)=>(l(),g(s(B),{key:o.id,group:o,"is-first-group":K===0,onInput:s(x)},null,8,["group","is-first-group","onInput"]))),128)),d(s(m),{class:"btn-add-group",green:"",small:"",title:"Add a new group",uppercase:"",onClick:_(s(P),["prevent"])},{default:c(()=>[d(j,{icon:s(Y)},null,8,["icon"]),n(" Group ")]),_:1},8,["onClick"])])]),e("footer",null,[d(s(m),{type:"submit"},{default:c(()=>[n("Save")]),_:1}),d(s(m),{class:"btn-cancel",white:"",onClick:_(y,["prevent"])},{default:c(()=>[n("Cancel")]),_:1},8,["onClick"])])],40,ae)]),_:1})}}});export{Ce as default};
